{assign var=this value=$ManageReportControl}
{formrestore id="report-filter"}

{loadscript file='/js/jquery.placeholder.min.js' type='js'}
{loadscript file='/js/pages/managereport.js' type='js'}

<h2>Отчёт о покупателях</h2>
<form id="buyers-filter" method="post" action="" style="max-width: 400px;">
    <div class="well">
        <input type="hidden" name="show" value="managereport"/>
        <input type="hidden" name="isalive" value="1"/>
        <div class="filter-buyers form-group form-inline">
            <label style="display: block;">Дата с:</label>
            <input class="form-control" type="text" name="startDay" placeholder="дд" value="{if $this.startDay != null}{$this.startDay}{/if}" style="width: 44px;" /> - 
            <input class="form-control" type="text" name="startMonth" placeholder="мм" value="{if $this.startMonth != null}{$this.startMonth}{/if}" style="width: 44px;" /> - 
            <input class="form-control" type="text" name="startYear" placeholder="гггг" value="{if $this.startYear != null}{$this.startYear}{/if}" style="width: 60px;" />
        </div>
        <div class="form-group form-inline">
            <label style="display: block;">Дата по:</label>
            <input class="form-control" type="text" name="finishDay" placeholder="дд" value="{if $this.finishDay != null}{$this.finishDay}{/if}" style="width:44px;" /> - 
            <input class="form-control" type="text" name="finishMonth" placeholder="мм" value="{if $this.finishMonth != null}{$this.finishMonth}{/if}" style="width:44px;" /> - 
            <input class="form-control" type="text" name="finishYear" placeholder="гггг" value="{if $this.finishYear != null}{$this.finishYear}{/if}" style="width: 60px;" />
        </div>
        <div class="form-group">
            <input class="btn btn-primary" type="submit" id="submit" value="Сформировать"/>
        </div>
    </div>
</form>

{if $this.reports}
    <a href="#" class="btn btn-primary" style="margin-bottom:15px;" onclick="window.location.href = '/adminka/index.php?show=managereport'; return false;">Обновить</a>
    <table class="table table-striped table-bordered table-hover" cellspacing="0" cellpadding="0">
        <tr>
            <th>ID</th>
            <th>С</th>
            <th>По</th>
            <th>Генерация начата</th>
            <th>Генерация завершена</th>
            <th>Статус</th>
            <th>Действия</th>
        </tr>
    {foreach from=$this.reports item=report}
        <tr class="{cycle values='color,'}">
            <td>{$report->id}</td>
            <td>{$report->tsStart|dateformat:'d.m.Y'}</td>
            <td>{$report->tsFinish|dateformat:'d.m.Y'}</td>
            <td>{$report->tsGenerateStart|dateformat:'d.m.Y, в H:i'}</td>
            <td>{if $report->tsGenerateFinish}{$report->tsGenerateFinish|dateformat:'d.m.Y, в H:i'}{else}-{/if}</td>
            <td>{if $report->status == 'STATUS_GENERATED'}Сформирован{else}<div id="bgrp-{$report->id}" class="gss-big-report">Формируется ... {if $report->totalUsersCount}{$report->currentUsersProcessed/$report->totalUsersCount*100|round0}%{/if}</div>{/if}</td>
            <td>
                {if $report->status == 'STATUS_GENERATED'}
                <a href="{alink do=adminsavereportxls id=$report->id}">Excel</a> | <a href="{alink do=adminsavereportcsv id=$report->id}">CSV</a> | 
                {/if}
                <a href="{alink do=admindelreport id=$report->id}" onclick="return confirm('Вы уверены что хотите удалить отчёт?');">Удалить</a>
            </td>
        </tr>
    {/foreach}
    </table>
{/if}