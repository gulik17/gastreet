{assign var=this value=$ManageInvoicesControl}
{formrestore id="invoices-filter"}

<h2>Счета на оплату</h2>

<a role="button" data-toggle="collapse" href="#collapseFilter" aria-expanded="false" aria-controls="collapseFilter"><h4>Фильтр для поиска <span class="caret"></span></h4></a>
<div id="form-filter-add-buttons">
    <div class="collapse" id="collapseFilter">
        <div class="well" style="max-width: 400px;">
            <form id="invoices-filter" method="post" action="">
                <input type="hidden" name="show" value="manageinvoices"/>
                <input type="hidden" name="isalive" value="1"/>
                <div class="filter">
                    <div class="form-group">
                        <label>ID (номер) счёта:</label>
                        <input class="form-control" type="text" name="id" id="id" />
                    </div>
                    <div class="form-group">
                        <input class="btn btn-info" type="submit" id="submit" value="Показать список отбора"/>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div>
        <a class="btn btn-success" href="{alink do=adminsaveinvoices}">Выгрузить все счета</a>
    </div>
</div>

<table class="table table-striped table-bordered table-hover" cellspacing="0" cellpadding="0">
    <tr>
        <th>ID (номер счёта)</th>
        <th>Контрагент</th>
        <th>Пользователь</th>
        <th>Сумма к оплате</th>
        <th>Оплачено</th>
        <th>Статус</th>
        <th>Дата создания</th>
        <th>Дата оплаты</th>
        <th>Действия</th>
    </tr>
    {if $this.payList}
        {foreach item=pay from=$this.payList}
            {assign var=status value=$pay->status}
            {assign var=userId value=$pay->userId}
            {assign var=oneuserdetails value=$this.userDetails.$userId}
            {assign var=oneuser value=$this.users.$userId}
            <tr class="{cycle values='color,'}">
                <td>{$pay->id}</td>
                <td><a href="{alink show=admininvoicedetails payid=$pay->id}">{$oneuserdetails->company} ({$oneuserdetails->inn}/{$oneuserdetails->kpp})</a></td>
                <td>ID: {$oneuser->id}, +{$oneuser->phone}{if $oneuser->lastname}, {$oneuser->lastname} {$oneuser->name}{/if}{if $oneuser->confirmedEmail}, {$oneuser->confirmedEmail}{else}{if $oneuser->email}, {/if}{$oneuser->email}{/if}</td>
                <td>{$pay->needAmount}</td>
                <td>{if $pay->payAmount}{$pay->payAmount}{else}-{/if}</td>
                <td>{$this.payStatuses.$status}</td>
                <td>{if $pay->tsCreated}{$pay->tsCreated|dateformat:'d.m.Y, в H:i'}{else}-{/if}</td>
                <td>{if $pay->tsUpdated}{$pay->tsUpdated|dateformat:'d.m.Y, в H:i'}{else}-{/if}</td>
                <td>
                    {if !$pay->payAmount && $status != 'STATUS_PAID'}
                        <a href="{alink do=invoicepayed id=$pay->id}" onclick="return confirm('Вы уверены, что данный счёт оплачен?');">Оплачен</a>&nbsp;
                        <a href="{alink do=delinvoice id=$pay->id}" onclick="return confirm('Вы уверены, что хотите удалить счет?');" style="color: #f00">Удалить</a>
                    {/if}
                </td>
            </tr>
        {/foreach}
    {else}
        <tr class="{cycle values='color,'}">
            <td colspan="9" class="text-center">Список пуст</td>
        </tr>
    {/if}
    </table>
    <p>{pager total=$this.total per=$this.perPage}</p>