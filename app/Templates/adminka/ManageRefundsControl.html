{assign var=this value=$ManageRefundsControl}
{formrestore id="refunds-filter"}

<h2>Требования на возврат</h2>

<a role="button" data-toggle="collapse" href="#collapseFilter" aria-expanded="false" aria-controls="collapseFilter"><h4>Фильтр для поиска <span class="caret"></span></h4></a>
<div class="collapse" id="collapseFilter">
    <form id="refunds-filter" method="post" action="" style="max-width: 400px;">
        <div class="well">
            <input type="hidden" name="show" value="manageinvoices"/>
            <input type="hidden" name="isalive" value="1"/>
            <div class="filter">
                <div class="form-group">
                    <label>ID (номер) требования:</label>
                    <input class="form-control" type="text" name="id" id="id" />
                </div>
                <div class="form-group">
                    <input type="submit" class="btn btn-info" id="submit" value="Показать список отбора"/>
                </div>
            </div>
        </div>
    </form>
</div>

<table class="table table-striped table-bordered table-hover" cellspacing="0" cellpadding="0">
    <tr>
        <th>ID (номер требования)</th>
        <th>Контрагент</th>
        <th>Сумма требования</th>
        <th>Сумма за заказ</th>
        <th>Сумма выплачена</th>
        <th>Статус</th>
        <th>Дата создания</th>
        <th>Дата выплаты</th>
        <th>Действия</th>
    </tr>
    {if $this.rrList}
        {foreach item=refund from=$this.rrList}
            {assign var=status value=$refund->status}
            {assign var=userId value=$refund->userId}
            {assign var=oneuser value=$this.userDetails.$userId}
            <tr class="{cycle values='color,'}">
                <td>{$refund->id}</td>
                <td>{$oneuser->company} ({$oneuser->inn}/{$oneuser->kpp})</td>
                <td>{if $refund->requestAmount > $refund->needAmount}<b>{$refund->requestAmount}</b>{else}{$refund->requestAmount}{/if}</td>
                <td>{$refund->needAmount}</td>
                <td>{if $refund->returnedAmount}{$refund->returnedAmount}{else}-{/if}</td>
                <td>{$this.rrStatuses.$status}</td>
                <td>{if $refund->tsCreated}{$refund->tsCreated|dateformat:'d.m.Y, в H:i'}{else}-{/if}</td>
                <td>{if $refund->tsUpdated}{$refund->tsUpdated|dateformat:'d.m.Y, в H:i'}{else}-{/if}</td>
                <td>{if !$refund->returnedAmount && $status != 'STATUS_PAID'}<a href="{alink show=refundpay id=$refund->id}">Выплатить</a>{/if}</td>
            </tr>
        {/foreach}
    {else}
        <tr class="{cycle values='color,'}">
            <td colspan="9" class="text-center">Список пуст</td>
        </tr>
    {/if}
</table>
{if $this.rrList}
{pager total=$this.total per=$this.perPage}
{/if}